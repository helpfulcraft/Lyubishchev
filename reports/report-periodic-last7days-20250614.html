<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>柳比歇夫时间统计报告</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f7fa;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1, h2 {
            color: #2c3e50;
            text-align: center;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .summary-item {
            background-color: #f8f9fa;
            border-left: 5px solid; /* Will be set dynamically */
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .summary-item h3 {
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.2em;
            color: #2c3e50;
            cursor: pointer; /* Add cursor pointer for collapsibles */
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .summary-item .total-time {
            font-size: 2em;
            font-weight: bold;
            color: #34495e;
            margin-bottom: 15px;
        }
        .summary-item .subcategory {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            color: #555;
            line-height: 1.5;
        }
        .tab-container {
            margin-bottom: 20px;
        }
        .tab-buttons {
            display: flex;
            border-bottom: 2px solid #ddd;
            flex-wrap: wrap;
        }
        .tab-button {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
        }
        .tab-button.active {
            color: #3498db;
            border-bottom-color: #3498db;
        }
        .tab-content {
            display: none;
            padding: 20px 0;
        }
        .tab-content.active {
            display: block;
        }
        .chart-container {
            height: 500px;
            width: 100%;
        }
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }
        .chart-wrapper {
            width: 100%;
        }
        .footer {
            margin-top: 30px;
            text-align: center;
            font-size: 0.9em;
            color: #888;
        }

        /* Styles for new details section */
        .details-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        .category-details h3 {
            margin: 0 0 15px 0;
            padding-left: 15px;
            border-left: 4px solid; /* color set dynamically */
            display: flex;
            align-items: center;
            font-size: 1.5em;
        }
        .category-color-indicator {
            display: inline-block;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 10px;
            position: relative;
            left: -27px;
        }
        .category-total-time {
            margin-left: auto;
            font-size: 0.8em;
            font-weight: normal;
            background-color: #e9ecef;
            padding: 3px 8px;
            border-radius: 12px;
            color: #555;
        }
        .item-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
            padding-left: 20px;
        }
        .item-card {
            background-color: #fdfdfd;
            border: 1px solid #eef;
            border-radius: 6px;
            padding: 15px;
        }
        .item-card h4 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.1em;
            color: #333;
            display: flex;
            justify-content: space-between;
        }
        .item-total-time {
            font-weight: normal;
            color: #777;
        }
        .item-card ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }
        .item-card li {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .item-card li:last-child {
            border-bottom: none;
        }
        .task-name {
            color: #555;
        }
        .task-time {
            font-weight: bold;
            color: #333;
        }
        .task-list {
            margin-top: 10px;
            padding-left: 10px;
            border-left: 2px solid #e0e0e0;
        }
        .task-list-item {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }
        .dark-mode .task-list {
            border-left-color: #555;
        }
        .dark-mode .task-list-item {
            color: #ccc;
        }

        /* Dark Mode Styles */
        body.dark-mode {
            background-color: #1a1a1a;
            color: #e0e0e0;
        }
        .dark-mode .card {
            background-color: #2c2c2c;
            box-shadow: 0 2px 10px rgba(0,0,0,0.4);
            border-top: 1px solid #444;
        }
        .dark-mode h1, .dark-mode h2 {
            color: #ffffff;
            border-bottom-color: #444;
        }
        .dark-mode .summary-item {
            background-color: #333;
            color: #f1f1f1;
        }
        .dark-mode .summary-item h3, .dark-mode .summary-item .total-time {
            color: #ffffff;
        }
        .dark-mode .summary-item .subcategory {
            color: #ccc;
        }
        .dark-mode .category-details h3 {
            border-left-color: #fff !important; /* Override inline style for visibility */
        }
        .dark-mode .item-card {
            background-color: #333;
            border-color: #444;
        }
        .dark-mode .item-card h4, .dark-mode .task-name, .dark-mode .task-time, .dark-mode .item-total-time {
            color: #f1f1f1;
        }
        .dark-mode .item-card li {
            border-bottom-color: #444;
        }
        .dark-mode .footer {
            color: #aaa;
        }

        /* Dark Mode Styles for Charts */
        .dark-mode .echarts-label {
            color: #ccc !important;
        }
        .dark-mode .pie-label-rich-name, .dark-mode .pie-label-rich-time, .dark-mode .pie-label-rich-percent {
            color: #ddd !important;
        }

        /* Theme Toggle Switch */
        .theme-switch-wrapper {
            display: flex;
            align-items: center;
            position: absolute;
            top: 20px;
            right: 20px;
        }
        .theme-switch {
            display: inline-block;
            height: 34px;
            position: relative;
            width: 60px;
        }
        .theme-switch input {
            display:none;
        }
        .slider {
            background-color: #ccc;
            bottom: 0;
            cursor: pointer;
            left: 0;
            position: absolute;
            right: 0;
            top: 0;
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            background-color: #fff;
            bottom: 4px;
            content: "";
            height: 26px;
            left: 4px;
            position: absolute;
            transition: .4s;
            width: 26px;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #2196F3;
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .collapsible-content {
            display: none; /* Hidden by default */
            padding-top: 10px;
            border-top: 1px solid #e9ecef;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="theme-switch-wrapper">
        <label class="theme-switch" for="checkbox">
            <input type="checkbox" id="checkbox" />
            <div class="slider"></div>
        </label>
    </div>

    <div class="container">
        <h1>
            柳比歇夫时间统计报告 
            
            <span style="font-size: 0.7em; color: #555; vertical-align: middle;">- 周期报告 (2025-06-14 to 2025-06-20)</span>
            
        </h1>

        <!-- This is now the ONLY layout, for both periodic and daily -->
        <div class="card">
            <h2>总览</h2>
            <div class="summary-grid">
                <!-- Jinja2 loop for summary cards -->
                
                <div class="summary-item" style="border-left-color: #f1c40f;">
                    <h3 onclick="toggleSummary('content-1')">
                        <span>娱乐</span>
                        <span class="total-time">44h 20m</span>
                    </h3>
                    <div class="collapsible-content" id="content-1">
                        
                        <div class="subcategory">
                            <span>游戏</span>
                            <strong>32h 40m</strong>
                        </div>
                        <div class="task-list">
                            
                            <div class="task-list-item">
                                <span>er</span>
                                <strong>30h 50m</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>卢岛食堂</span>
                                <strong>1h 21m</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>er联赛</span>
                                <strong>29m</strong>
                            </div>
                            
                        </div>
                        
                        <div class="subcategory">
                            <span>小说</span>
                            <strong>11h 13m</strong>
                        </div>
                        <div class="task-list">
                            
                            <div class="task-list-item">
                                <span>宋钦宗</span>
                                <strong>2h 44m</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>大家唐车库</span>
                                <strong>1h 23m</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>惊涛落日</span>
                                <strong>1h 11m</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>南朝</span>
                                <strong>1h</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>清理员</span>
                                <strong>49m</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>哈基黑</span>
                                <strong>48m</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>番茄冲浪</span>
                                <strong>36m</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>接手地府</span>
                                <strong>32m</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>美服</span>
                                <strong>32m</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>三塔游戏</span>
                                <strong>31m</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>天灾信使</span>
                                <strong>26m</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>终极火力</span>
                                <strong>21m</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>就职皇帝</span>
                                <strong>20m</strong>
                            </div>
                            
                        </div>
                        
                        <div class="subcategory">
                            <span>冲浪</span>
                            <strong>15m</strong>
                        </div>
                        <div class="task-list">
                            
                            <div class="task-list-item">
                                <span>1999</span>
                                <strong>15m</strong>
                            </div>
                            
                        </div>
                        
                        <div class="subcategory">
                            <span>漫画</span>
                            <strong>12m</strong>
                        </div>
                        <div class="task-list">
                            
                            <div class="task-list-item">
                                <span>女鬼求婚</span>
                                <strong>12m</strong>
                            </div>
                            
                        </div>
                        
                    </div>
                </div>
                
                <div class="summary-item" style="border-left-color: #e74c3c;">
                    <h3 onclick="toggleSummary('content-2')">
                        <span>杂项</span>
                        <span class="total-time">9h 53m</span>
                    </h3>
                    <div class="collapsible-content" id="content-2">
                        
                        <div class="subcategory">
                            <span>日常</span>
                            <strong>6h</strong>
                        </div>
                        <div class="task-list">
                            
                            <div class="task-list-item">
                                <span>琐事</span>
                                <strong>3h 16m</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>涩涩</span>
                                <strong>1h 28m</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>睡觉</span>
                                <strong>47m</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>洗衣服</span>
                                <strong>29m</strong>
                            </div>
                            
                        </div>
                        
                        <div class="subcategory">
                            <span>工程</span>
                            <strong>3h 53m</strong>
                        </div>
                        <div class="task-list">
                            
                            <div class="task-list-item">
                                <span>作业</span>
                                <strong>1h 35m</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>琐事</span>
                                <strong>1h 6m</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>儿童大世界</span>
                                <strong>34m</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>zsxq</span>
                                <strong>18m</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>神游</span>
                                <strong>13m</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>notionButton</span>
                                <strong>7m</strong>
                            </div>
                            
                        </div>
                        
                    </div>
                </div>
                
                <div class="summary-item" style="border-left-color: #9b59b6;">
                    <h3 onclick="toggleSummary('content-3')">
                        <span>根源</span>
                        <span class="total-time">6h 47m</span>
                    </h3>
                    <div class="collapsible-content" id="content-3">
                        
                        <div class="subcategory">
                            <span>演出</span>
                            <strong>4h</strong>
                        </div>
                        <div class="task-list">
                            
                            <div class="task-list-item">
                                <span>红丝绒</span>
                                <strong>3h 53m</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>复乐园</span>
                                <strong>7m</strong>
                            </div>
                            
                        </div>
                        
                        <div class="subcategory">
                            <span>游戏</span>
                            <strong>2h 3m</strong>
                        </div>
                        <div class="task-list">
                            
                            <div class="task-list-item">
                                <span>潜渊症</span>
                                <strong>2h 3m</strong>
                            </div>
                            
                        </div>
                        
                        <div class="subcategory">
                            <span>小说</span>
                            <strong>44m</strong>
                        </div>
                        <div class="task-list">
                            
                            <div class="task-list-item">
                                <span>惊涛落日</span>
                                <strong>44m</strong>
                            </div>
                            
                        </div>
                        
                    </div>
                </div>
                
                <div class="summary-item" style="border-left-color: #3498db;">
                    <h3 onclick="toggleSummary('content-4')">
                        <span>第一类</span>
                        <span class="total-time">4h 29m</span>
                    </h3>
                    <div class="collapsible-content" id="content-4">
                        
                        <div class="subcategory">
                            <span>学习</span>
                            <strong>4h 29m</strong>
                        </div>
                        <div class="task-list">
                            
                            <div class="task-list-item">
                                <span>kate</span>
                                <strong>1h 47m</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>zsxq</span>
                                <strong>1h 27m</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>探讨语言帝国</span>
                                <strong>1h 15m</strong>
                            </div>
                            
                        </div>
                        
                    </div>
                </div>
                
                <div class="summary-item" style="border-left-color: #2ecc71;">
                    <h3 onclick="toggleSummary('content-5')">
                        <span>第二类</span>
                        <span class="total-time">18h 59m</span>
                    </h3>
                    <div class="collapsible-content" id="content-5">
                        
                        <div class="subcategory">
                            <span>折腾</span>
                            <strong>8h 29m</strong>
                        </div>
                        <div class="task-list">
                            
                            <div class="task-list-item">
                                <span>柳比歇夫日结可视化</span>
                                <strong>6h 1m</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>节奏光剑选曲</span>
                                <strong>1h 7m</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>Ruby</span>
                                <strong>1h</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>readset上位</span>
                                <strong>13m</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>zsxq</span>
                                <strong>8m</strong>
                            </div>
                            
                        </div>
                        
                        <div class="subcategory">
                            <span>锻炼</span>
                            <strong>5h 18m</strong>
                        </div>
                        <div class="task-list">
                            
                            <div class="task-list-item">
                                <span>节奏光剑</span>
                                <strong>5h 18m</strong>
                            </div>
                            
                        </div>
                        
                        <div class="subcategory">
                            <span>冲浪</span>
                            <strong>2h 48m</strong>
                        </div>
                        <div class="task-list">
                            
                            <div class="task-list-item">
                                <span>科技周刊</span>
                                <strong>1h 23m</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>小黑盒</span>
                                <strong>1h</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>b站冲浪</span>
                                <strong>20m</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>c#大更新</span>
                                <strong>5m</strong>
                            </div>
                            
                        </div>
                        
                        <div class="subcategory">
                            <span>博物</span>
                            <strong>2h 20m</strong>
                        </div>
                        <div class="task-list">
                            
                            <div class="task-list-item">
                                <span>哥布林起源</span>
                                <strong>46m</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>锈根工作室</span>
                                <strong>30m</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>丝之歌为何不发售</span>
                                <strong>22m</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>和周报</span>
                                <strong>22m</strong>
                            </div>
                            
                            <div class="task-list-item">
                                <span>badapple</span>
                                <strong>20m</strong>
                            </div>
                            
                        </div>
                        
                        <div class="subcategory">
                            <span>思考</span>
                            <strong>4m</strong>
                        </div>
                        <div class="task-list">
                            
                            <div class="task-list-item">
                                <span>无趣的网文</span>
                                <strong>4m</strong>
                            </div>
                            
                        </div>
                        
                    </div>
                </div>
                

                <!-- Grand Total Card -->
                <div class="summary-item" style="border-left-color: #7f8c8d;">
                    <h3>总计</h3>
                    <div class="total-time">84h 28m</div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2>图表分析</h2>
            <div class="chart-grid">
                <div class="chart-wrapper">
                    <h3>时间分配比例 (主类)</h3>
                    <div class="chart-container" id="pieChartContainer"></div>
                </div>
                <div class="chart-wrapper">
                    <h3>各类别子项时间分配</h3>
                     <div class="chart-container" id="stackedBarContainer" style="height: 600px;"></div>
                </div>
                <div class="chart-wrapper">
                     <h3>时间分配层次结构</h3>
                     <div class="chart-container" id="sunburstChartContainer"></div>
                </div>
                 
            </div>
        </div>

        <div class="footer">
            <p>报告生成于 2025-06-20 18:34:24</p>
        </div>
    </div>

    <script>
        // --- Utility Functions (from example) ---
        function minutesToTime(minutes) {
            if (minutes === null || minutes === undefined || minutes < 0) return '0m';
            if (minutes === 0) return '0m';
            const hours = Math.floor(minutes / 60);
            const mins = minutes % 60;
            let result = '';
            if (hours > 0) result += `${hours}h`;
            if (mins > 0) result += (hours > 0 ? ' ' : '') + `${mins}m`;
            return result;
        }
        
        function toggleSummary(elementId) {
            const content = document.getElementById(elementId);
            if (content.style.display === 'block') {
                content.style.display = 'none';
            } else {
                content.style.display = 'block';
            }
        }
        
        // --- Data from Python (Now always the same variables) ---
        const chartData = [{"children": [{"children": [{"name": "er", "time_str": "30h 50m", "value": 1850}, {"name": "\u5362\u5c9b\u98df\u5802", "time_str": "1h 21m", "value": 81}, {"name": "er\u8054\u8d5b", "time_str": "29m", "value": 29}], "name": "\u6e38\u620f", "value": 1960, "value_str": "32h 40m"}, {"children": [{"name": "\u5b8b\u94a6\u5b97", "time_str": "2h 44m", "value": 164}, {"name": "\u5927\u5bb6\u5510\u8f66\u5e93", "time_str": "1h 23m", "value": 83}, {"name": "\u60ca\u6d9b\u843d\u65e5", "time_str": "1h 11m", "value": 71}, {"name": "\u5357\u671d", "time_str": "1h", "value": 60}, {"name": "\u6e05\u7406\u5458", "time_str": "49m", "value": 49}, {"name": "\u54c8\u57fa\u9ed1", "time_str": "48m", "value": 48}, {"name": "\u756a\u8304\u51b2\u6d6a", "time_str": "36m", "value": 36}, {"name": "\u63a5\u624b\u5730\u5e9c", "time_str": "32m", "value": 32}, {"name": "\u7f8e\u670d", "time_str": "32m", "value": 32}, {"name": "\u4e09\u5854\u6e38\u620f", "time_str": "31m", "value": 31}, {"name": "\u5929\u707e\u4fe1\u4f7f", "time_str": "26m", "value": 26}, {"name": "\u7ec8\u6781\u706b\u529b", "time_str": "21m", "value": 21}, {"name": "\u5c31\u804c\u7687\u5e1d", "time_str": "20m", "value": 20}], "name": "\u5c0f\u8bf4", "value": 673, "value_str": "11h 13m"}, {"children": [{"name": "1999", "time_str": "15m", "value": 15}], "name": "\u51b2\u6d6a", "value": 15, "value_str": "15m"}, {"children": [{"name": "\u5973\u9b3c\u6c42\u5a5a", "time_str": "12m", "value": 12}], "name": "\u6f2b\u753b", "value": 12, "value_str": "12m"}], "itemStyle": {"color": "#f1c40f"}, "name": "\u5a31\u4e50", "value": 2660, "value_str": "44h 20m"}, {"children": [{"children": [{"name": "\u7410\u4e8b", "time_str": "3h 16m", "value": 196}, {"name": "\u6da9\u6da9", "time_str": "1h 28m", "value": 88}, {"name": "\u7761\u89c9", "time_str": "47m", "value": 47}, {"name": "\u6d17\u8863\u670d", "time_str": "29m", "value": 29}], "name": "\u65e5\u5e38", "value": 360, "value_str": "6h"}, {"children": [{"name": "\u4f5c\u4e1a", "time_str": "1h 35m", "value": 95}, {"name": "\u7410\u4e8b", "time_str": "1h 6m", "value": 66}, {"name": "\u513f\u7ae5\u5927\u4e16\u754c", "time_str": "34m", "value": 34}, {"name": "zsxq", "time_str": "18m", "value": 18}, {"name": "\u795e\u6e38", "time_str": "13m", "value": 13}, {"name": "notionButton", "time_str": "7m", "value": 7}], "name": "\u5de5\u7a0b", "value": 233, "value_str": "3h 53m"}], "itemStyle": {"color": "#e74c3c"}, "name": "\u6742\u9879", "value": 593, "value_str": "9h 53m"}, {"children": [{"children": [{"name": "\u7ea2\u4e1d\u7ed2", "time_str": "3h 53m", "value": 233}, {"name": "\u590d\u4e50\u56ed", "time_str": "7m", "value": 7}], "name": "\u6f14\u51fa", "value": 240, "value_str": "4h"}, {"children": [{"name": "\u6f5c\u6e0a\u75c7", "time_str": "2h 3m", "value": 123}], "name": "\u6e38\u620f", "value": 123, "value_str": "2h 3m"}, {"children": [{"name": "\u60ca\u6d9b\u843d\u65e5", "time_str": "44m", "value": 44}], "name": "\u5c0f\u8bf4", "value": 44, "value_str": "44m"}], "itemStyle": {"color": "#9b59b6"}, "name": "\u6839\u6e90", "value": 407, "value_str": "6h 47m"}, {"children": [{"children": [{"name": "kate", "time_str": "1h 47m", "value": 107}, {"name": "zsxq", "time_str": "1h 27m", "value": 87}, {"name": "\u63a2\u8ba8\u8bed\u8a00\u5e1d\u56fd", "time_str": "1h 15m", "value": 75}], "name": "\u5b66\u4e60", "value": 269, "value_str": "4h 29m"}], "itemStyle": {"color": "#3498db"}, "name": "\u7b2c\u4e00\u7c7b", "value": 269, "value_str": "4h 29m"}, {"children": [{"children": [{"name": "\u67f3\u6bd4\u6b47\u592b\u65e5\u7ed3\u53ef\u89c6\u5316", "time_str": "6h 1m", "value": 361}, {"name": "\u8282\u594f\u5149\u5251\u9009\u66f2", "time_str": "1h 7m", "value": 67}, {"name": "Ruby", "time_str": "1h", "value": 60}, {"name": "readset\u4e0a\u4f4d", "time_str": "13m", "value": 13}, {"name": "zsxq", "time_str": "8m", "value": 8}], "name": "\u6298\u817e", "value": 509, "value_str": "8h 29m"}, {"children": [{"name": "\u8282\u594f\u5149\u5251", "time_str": "5h 18m", "value": 318}], "name": "\u953b\u70bc", "value": 318, "value_str": "5h 18m"}, {"children": [{"name": "\u79d1\u6280\u5468\u520a", "time_str": "1h 23m", "value": 83}, {"name": "\u5c0f\u9ed1\u76d2", "time_str": "1h", "value": 60}, {"name": "b\u7ad9\u51b2\u6d6a", "time_str": "20m", "value": 20}, {"name": "c#\u5927\u66f4\u65b0", "time_str": "5m", "value": 5}], "name": "\u51b2\u6d6a", "value": 168, "value_str": "2h 48m"}, {"children": [{"name": "\u54e5\u5e03\u6797\u8d77\u6e90", "time_str": "46m", "value": 46}, {"name": "\u9508\u6839\u5de5\u4f5c\u5ba4", "time_str": "30m", "value": 30}, {"name": "\u4e1d\u4e4b\u6b4c\u4e3a\u4f55\u4e0d\u53d1\u552e", "time_str": "22m", "value": 22}, {"name": "\u548c\u5468\u62a5", "time_str": "22m", "value": 22}, {"name": "badapple", "time_str": "20m", "value": 20}], "name": "\u535a\u7269", "value": 140, "value_str": "2h 20m"}, {"children": [{"name": "\u65e0\u8da3\u7684\u7f51\u6587", "time_str": "4m", "value": 4}], "name": "\u601d\u8003", "value": 4, "value_str": "4m"}], "itemStyle": {"color": "#2ecc71"}, "name": "\u7b2c\u4e8c\u7c7b", "value": 1139, "value_str": "18h 59m"}];
        const pieData = [{"itemStyle": {"color": "#f1c40f"}, "name": "\u5a31\u4e50", "value": 2660}, {"itemStyle": {"color": "#e74c3c"}, "name": "\u6742\u9879", "value": 593}, {"itemStyle": {"color": "#9b59b6"}, "name": "\u6839\u6e90", "value": 407}, {"itemStyle": {"color": "#3498db"}, "name": "\u7b2c\u4e00\u7c7b", "value": 269}, {"itemStyle": {"color": "#2ecc71"}, "name": "\u7b2c\u4e8c\u7c7b", "value": 1139}];
        const stackedBarData = {"legend": ["\u51b2\u6d6a", "\u535a\u7269", "\u5b66\u4e60", "\u5c0f\u8bf4", "\u5de5\u7a0b", "\u601d\u8003", "\u6298\u817e", "\u65e5\u5e38", "\u6e38\u620f", "\u6f14\u51fa", "\u6f2b\u753b", "\u953b\u70bc"], "series": [{"data": [15, 0, 0, 0, 168], "emphasis": {"focus": "series"}, "name": "\u51b2\u6d6a", "stack": "total", "type": "bar"}, {"data": [0, 0, 0, 0, 140], "emphasis": {"focus": "series"}, "name": "\u535a\u7269", "stack": "total", "type": "bar"}, {"data": [0, 0, 0, 269, 0], "emphasis": {"focus": "series"}, "name": "\u5b66\u4e60", "stack": "total", "type": "bar"}, {"data": [673, 0, 44, 0, 0], "emphasis": {"focus": "series"}, "name": "\u5c0f\u8bf4", "stack": "total", "type": "bar"}, {"data": [0, 233, 0, 0, 0], "emphasis": {"focus": "series"}, "name": "\u5de5\u7a0b", "stack": "total", "type": "bar"}, {"data": [0, 0, 0, 0, 4], "emphasis": {"focus": "series"}, "name": "\u601d\u8003", "stack": "total", "type": "bar"}, {"data": [0, 0, 0, 0, 509], "emphasis": {"focus": "series"}, "name": "\u6298\u817e", "stack": "total", "type": "bar"}, {"data": [0, 360, 0, 0, 0], "emphasis": {"focus": "series"}, "name": "\u65e5\u5e38", "stack": "total", "type": "bar"}, {"data": [1960, 0, 123, 0, 0], "emphasis": {"focus": "series"}, "name": "\u6e38\u620f", "stack": "total", "type": "bar"}, {"data": [0, 0, 240, 0, 0], "emphasis": {"focus": "series"}, "name": "\u6f14\u51fa", "stack": "total", "type": "bar"}, {"data": [12, 0, 0, 0, 0], "emphasis": {"focus": "series"}, "name": "\u6f2b\u753b", "stack": "total", "type": "bar"}, {"data": [0, 0, 0, 0, 318], "emphasis": {"focus": "series"}, "name": "\u953b\u70bc", "stack": "total", "type": "bar"}], "yAxis": ["\u5a31\u4e50", "\u6742\u9879", "\u6839\u6e90", "\u7b2c\u4e00\u7c7b", "\u7b2c\u4e8c\u7c7b"]};
        const historicalData = null;

        // --- Chart Initialization ---
        function initCharts(theme = 'light') {
            const isDarkMode = theme === 'dark';

            // Dispose existing charts if they exist
            if (document.getElementById('sunburstChartContainer')) echarts.dispose(document.getElementById('sunburstChartContainer'));
            if (document.getElementById('pieChartContainer')) echarts.dispose(document.getElementById('pieChartContainer'));
            if (document.getElementById('stackedBarContainer')) echarts.dispose(document.getElementById('stackedBarContainer'));
            if (document.getElementById('lineChartContainer') && historicalData && historicalData.dates) {
                 echarts.dispose(document.getElementById('lineChartContainer'));
            }

            // --- Sunburst Chart ---
            if (document.getElementById('sunburstChartContainer')) {
                const sunburstChart = echarts.init(document.getElementById('sunburstChartContainer'), theme);
                sunburstChart.setOption({
                    title: { text: '', left: 'center' },
                    tooltip: {
                        trigger: 'item',
                        formatter: function(params) {
                            return `${params.name}: ${minutesToTime(params.value)}`;
                        }
                    },
                    legend: {
                        orient: 'vertical',
                        left: 'right',
                        top: 'center'
                    },
                    series: {
                        type: 'sunburst',
                        data: chartData,
                        radius: [0, '90%'],
                        label: {
                            rotate: 'radial',
                            formatter: function(params) {
                                if (params.data.value / params.treePathInfo[0].value < 0.01 && params.treePathInfo.length > 2) {
                                    return '';
                                }
                                // Always show name and time
                                return `${params.name} ${minutesToTime(params.value)}`;
                            }
                        },
                        levels: [
                            {}, // Level 0 (center)
                            {}, // Level 1 (categories)
                            { // Level 2 (items)
                              label: {
                                show: false
                              }
                            },
                            { // Level 3 (tasks)
                                label: { 
                                    show: true,
                                    rotate: 'tangential'
                                },
                                emphasis: {
                                    label: { show: true }
                                }
                            }
                        ],
                        emphasis: { focus: 'ancestor' }
                    }
                });
                window.addEventListener('resize', () => sunburstChart.resize());
            }

            // --- Pie Chart ---
            if (document.getElementById('pieChartContainer')) {
                const pieChart = echarts.init(document.getElementById('pieChartContainer'), theme);
                pieChart.setOption({
                    title: { text: '', left: 'center' },
                    tooltip: {
                        trigger: 'item',
                        formatter: function(params) {
                            return `${params.seriesName}<br/>${params.name}: ${minutesToTime(params.value)} (${params.percent}%)`;
                        }
                    },
                    legend: { 
                        orient: 'vertical',
                        left: 'right',
                        top: 'center'
                    }, 
                    series: [{
                        name: '时间分配',
                        type: 'pie',
                        radius: '60%', // Adjust radius to give labels more space
                        center: ['50%', '55%'],
                        data: pieData,
                        emphasis: {
                            itemStyle: { shadowBlur: 10, shadowOffsetX: 0, shadowColor: 'rgba(0, 0, 0, 0.5)' }
                        },
                        label: {
                            show: true,
                            position: 'outer',
                            formatter: function(params) {
                                // Use different class for dark mode to apply specific styles
                                const richClass = isDarkMode ? 'pie-label-rich-dark' : 'pie-label-rich';
                                return `{name|${params.name}}\n{time|${minutesToTime(params.value)}} ({percent|${params.percent}%})`;
                            },
                            rich: {
                                name: {
                                    fontSize: 14,
                                    color: isDarkMode ? '#eee' : '#333'
                                },
                                time: {
                                    fontSize: 12,
                                    color: isDarkMode ? '#ccc' : '#666',
                                    padding: [2, 0]
                                },
                                percent: {
                                    fontSize: 12,
                                    color: isDarkMode ? '#ccc' : '#666'
                                }
                            }
                        },
                        labelLine: {
                            show: true,
                            length: 15,
                            length2: 10
                        }
                    }]
                });
                window.addEventListener('resize', () => pieChart.resize());
            }
            
            // --- Stacked Bar Chart ---
            if (document.getElementById('stackedBarContainer')) {
                const stackedBarChart = echarts.init(document.getElementById('stackedBarContainer'), theme);
                stackedBarChart.setOption({
                    title: { text: '', left: 'center' },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: { type: 'shadow' },
                        formatter: function(params) {
                            let categoryName = params[0].axisValue;
                            let total = 0;
                            let result = `${categoryName}<br/>`;
                            params.forEach(param => {
                                if (param.value > 0) {
                                    total += param.value;
                                    result += `${param.marker} ${param.seriesName}: ${minutesToTime(param.value)}<br/>`;
                                }
                            });
                            result += `<b>总计: ${minutesToTime(total)}</b>`;
                            return result;
                        }
                    },
                    legend: {
                        type: 'scroll',
                        orient: 'vertical',
                        right: 10,
                        top: 40,
                        bottom: 20,
                        data: stackedBarData.legend
                    },
                    grid: { left: '3%', right: '15%', bottom: '3%', containLabel: true },
                    xAxis: {
                        type: 'value',
                        axisLabel: { formatter: minutesToTime }
                    },
                    yAxis: {
                        type: 'category',
                        data: stackedBarData.yAxis
                    },
                    series: stackedBarData.series.map(s => ({
                        ...s,
                        label: {
                            show: true,
                            position: 'inside',
                            formatter: function(params) {
                                 if (params.value <= 0) return '';
                                 // Show both name and time, similar to the reference example
                                 const subName = params.seriesName;
                                 return `${subName}\n${minutesToTime(params.value)}`;
                            },
                            color: '#fff',
                            textShadowBlur: 1,
                            textShadowColor: 'rgba(0, 0, 0, 0.4)'
                        }
                    }))
                });
                window.addEventListener('resize', () => stackedBarChart.resize());
            }

            // --- Historical Line Chart (for Daily) ---
            if (document.getElementById('lineChartContainer') && historicalData && historicalData.dates) {
                // --- Line Chart for Historical Trends ---
                const lineChart = echarts.init(document.getElementById('lineChartContainer'), theme);
                lineChart.setOption({
                    title: { text: '', left: 'center' },
                    tooltip: {
                        trigger: 'axis',
                        formatter: function (params) {
                            let res = params[0].name + '<br/>';
                            params.forEach(function (item) {
                                res += item.marker + ' ' + item.seriesName + ' : ' + minutesToTime(item.value) + '<br/>';
                            });
                            return res;
                        }
                    },
                    legend: {
                        data: historicalData.categories,
                        top: 'bottom'
                    },
                    grid: {
                        left: '3%',
                        right: '8%',
                        bottom: '10%',
                        containLabel: true
                    },
                    xAxis: {
                        type: 'category',
                        boundaryGap: false,
                        data: historicalData.dates
                    },
                    yAxis: {
                        type: 'value',
                        axisLabel: {
                            formatter: minutesToTime
                        }
                    },
                    series: historicalData.series
                });

                 // Add resize listeners for new charts
                window.addEventListener('resize', function() {
                    lineChart.resize();
                });
            }

            // Resize charts on window resize
            window.addEventListener('resize', function() {
                if(document.getElementById('sunburstChartContainer')) echarts.getInstanceByDom(document.getElementById('sunburstChartContainer'))?.resize();
                if(document.getElementById('pieChartContainer')) echarts.getInstanceByDom(document.getElementById('pieChartContainer'))?.resize();
                if(document.getElementById('stackedBarContainer')) echarts.getInstanceByDom(document.getElementById('stackedBarContainer'))?.resize();
                if (document.getElementById('lineChartContainer') && historicalData && historicalData.dates) {
                    echarts.getInstanceByDom(document.getElementById('lineChartContainer'))?.resize();
                }
            });
        }

        // --- Theme Toggling Logic ---
        const toggleSwitch = document.querySelector('.theme-switch input[type="checkbox"]');
        const currentTheme = localStorage.getItem('theme');

        function switchTheme(e) {
            if (e.target.checked) {
                document.body.classList.add('dark-mode');
                localStorage.setItem('theme', 'dark');
                initCharts('dark');
            } else {
                document.body.classList.remove('dark-mode');
                localStorage.setItem('theme', 'light');
                initCharts('light');
            }    
        }

        toggleSwitch.addEventListener('change', switchTheme, false);

        if (currentTheme) {
            document.body.classList.toggle('dark-mode', currentTheme === 'dark');
            toggleSwitch.checked = currentTheme === 'dark';
        }

        // --- Page Load ---
        window.onload = function() {
            initCharts(currentTheme || 'light');
            
            // Initial resize logic is a bit complex now. The initCharts handles it.
            // Let's just keep the theme-based initialization.
        };
    </script>
</body>
</html> 